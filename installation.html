<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
<head>
    <title>Linux 802.11n CSI Tool &mdash; Installation Instructions</title>
    <link rel="stylesheet" href="css/dan.css"/>
</head>
<body width=600>


<center>
	<H1>Linux 802.11n CSI Tool</H1>
	<H4><a href="https://github.com/dhalperi/linux-80211n-csitool/">GitHub</a> | <a href="index.html">Main Page</a> |
	<a href="faq.html">FAQ</a> | <a href="https://github.com/dhalperi/linux-80211n-csitool-supplementary/blob/master/CONTRIBUTING.md">Get Help</a></H4>
</center>

<!--- ********************************************************************* -->

<H2>Installation Instructions</H2>

<p><em>The instructions below have been updated to simplify the installation process and to work with newer Linux releases. You can also refer to the <a href="old_installation.html">old installation instructions</a>.</em></p>

<!--- ********************************************************************* -->
<H3>1. Prerequisites</H3>

<p>Install the build tools, the Linux kernel development headers, and the Git client. Using Ubuntu:</p>
<pre>
sudo apt-get install gcc make linux-headers-$(uname -r) git-core
</pre>

<p><em>Optional:</em> If you plan to set up the wireless interface with command line utilities such as <em>iw</em>, you need to disable <em>NetworkManager</em> from controlling the interface (if it is installed). Using Ubuntu:</p>
<pre>
sudo apt-get install iw
echo iface wlan0 inet manual | sudo tee -a /etc/network/interfaces
sudo restart network-manager
</pre>

<p><em>Tip:</em> You might want to prevent the wireless driver from automatically loading during boot&mdash;for example, if you make additional modifications to it that could crash the kernel. To do this, run:</p>
<pre>
echo blacklist iwldvm | sudo tee -a /etc/modprobe.d/csitool.conf
echo blacklist iwlwifi | sudo tee -a /etc/modprobe.d/csitool.conf
</pre>

<!--- ********************************************************************* -->
<H3>2. Build and Install the Modified Wireless Driver</H3>

<p>Obtain the CSI Tool Linux source tree, and checkout the tag for your kernel version:</p>
<pre>
CSITOOL_KERNEL_TAG=csitool-$(uname -r | cut -d . -f 1-2)
git clone https://github.com/dhalperi/linux-80211n-csitool.git
cd linux-80211n-csitool
git checkout ${CSITOOL_KERNEL_TAG}
</pre>

<p><em>Tip:</em> You can merge the driver modifications into the source tree for your specific kernel version, which might resolve build errors or improve compatibility. Using Ubuntu:</p>
<pre>
UBUNTU_KERNEL_TAG=Ubuntu-3.13.0-32.57
# Modify the line above with your Ubuntu kernel tag. First, determine your full kernel
# version by reading /proc/version_signature; then, look up the Ubuntu kernel tag at:
# http://people.canonical.com/~kernel/info/kernel-version-map.html

. /etc/lsb-release
git remote add ubuntu git://kernel.ubuntu.com/ubuntu/ubuntu-${DISTRIB_CODENAME}.git
git pull --no-edit ubuntu ${UBUNTU_KERNEL_TAG}
</pre>

<p>Build the modified driver for the existing kernel:</p>
<pre>
make -C /lib/modules/$(uname -r)/build M=$(pwd)/drivers/net/wireless/iwlwifi modules
</pre>

<p>Install the modified driver into the module updates directory:</p>
<pre>
sudo make -C /lib/modules/$(uname -r)/build M=$(pwd)/drivers/net/wireless/iwlwifi INSTALL_MOD_DIR=updates \
    modules_install
sudo depmod
cd ..
</pre>

<p><em>Tip:</em> If the message "<tt>Can't read private key</tt>" appears, it indicates the module could not be signed. This will not cause a problem unless the kernel enforces module signature verification.</p>

<!--- ********************************************************************* -->
<H3>3. Install the Modified Firmware</H3>

<p>Obtain the CSI Tool supplementary material:</p>
<pre>
git clone https://github.com/dhalperi/linux-80211n-csitool-supplementary.git
</pre>

<p>Relocate any existing firmware for Intel Wi-Fi Link 5000 Series adapters:</p>
<pre>
for file in /lib/firmware/iwlwifi-5000-*.ucode; do sudo mv $file $file.orig; done
</pre>

<p>Install the modified firmware:</p>
<pre>
sudo cp linux-80211n-csitool-supplementary/firmware/iwlwifi-5000-2.ucode.sigcomm2010 /lib/firmware/
sudo ln -s iwlwifi-5000-2.ucode.sigcomm2010 /lib/firmware/iwlwifi-5000-2.ucode
</pre>

<!--- ********************************************************************* -->
<H3>4. Build the Userspace Logging Tool</H3>

<p>Build <em>log_to_file</em>, a command line tool that writes CSI obtained via the driver to a file:</p>

<pre>
make -C linux-80211n-csitool-supplementary/netlink
</pre>

<!--- ********************************************************************* -->
<H3>5. Enable Logging and Test</H3>

<p>Unload the driver:</p>

<pre>
sudo modprobe -r iwlwifi mac80211
</pre>

<p><em>Tip:</em> On distributions other than Ubuntu, you may see the message "<tt>FATAL: Module iwlwifi is in use.</tt>" when you try to unload the driver. If this occurs, use the following command instead:</p>

<pre>
sudo modprobe -r iwldvm iwlwifi mac80211
</pre>

<p>Once the driver is unloaded, reload it with CSI logging enabled:</p>

<pre>
sudo modprobe iwlwifi connector_log=0x1
</pre>

<p>Connect to an 802.11n access point&mdash;using <em>iw</em> and <em>iproute2</em>, for example (or <em>NetworkManager</em>). Alternatively, let your system operate as an 802.11n access point by installing and configuring <em>hostapd</em> (sample configurations are in the supplementary material), then connect a station to it.</p>

<p>Once you are connected, begin logging CSI to a file:</p>
<pre>
sudo linux-80211n-csitool-supplementary/netlink/log_to_file csi.dat
</pre>

<p>At a different terminal, run the <em>ping</em> command with the IP address of the access point (or the connected station). If replies are sent back at High Throughput (802.11n) bitrates, <em>log_to_file</em> will write the CSI for each received packet to the file, and also print a message to the terminal. Note that depending on the rate selection algorithm, the first few packets are typically sent at Legacy (802.11a/b/g) bitrates instead of High Throughput bitrates; these will not provide CSI.</p>

<p>Make sure to see the <a href="faq.html">FAQ</a> for more details about collecting CSI.</p>

<!--- ********************************************************************* -->

<center>
	<H4><a href="index.html">Back to the main page</a></H4>
</center>

<!--- ********************************************************************* -->
    <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ?
        "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost +
        "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
        var pageTracker = _gat._getTracker("UA-3907502-1");
        pageTracker._initData();
        pageTracker._trackPageview();
    </script>
</body>
</html>
