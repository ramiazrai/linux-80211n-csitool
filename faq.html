<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
<head>
    <title>Linux 802.11n CSI Tool &mdash; FAQ, Things to Know, and Troubleshooting</title>
    <link rel="stylesheet" href="css/dan.css"/>
</head>
<body width=600>

<!--- ********************************************************************* -->
<script language="javascript">
	function toggle(link, divId) {
		var lText = link.innerHTML;
		var d = document.getElementById(divId);
		if (lText == '+') {
			link.innerHTML = '&#8722;';
			d.style.display = 'block';
		} else {
			link.innerHTML = '+';
			d.style.display = 'none';
		}
	}
</script>
<!--- ********************************************************************* -->

<center>
	<H1>Linux 802.11n CSI Tool</H1>
	<H4><a href="https://github.com/dhalperi/linux-80211n-csitool/">GitHub</a> | <a href="index.html">Main Page</a> |
	<a href="installation.html">Installation Instructions</a> | <a href="https://github.com/dhalperi/linux-80211n-csitool-supplementary/blob/master/CONTRIBUTING.md">Get Help</a></H4>
</center>

<H2>FAQ, Things to Know, and Troubleshooting</H2>

<!--- ********************************************************************* -->
<H3 id="faqrate">1. How do I set wireless data rates (or get/set other station information)? [<a href="javascript:void(0);" onclick="toggle(this, 'faqratefold');">+</a>] </H3>

<div id="faqratefold" style="display:none;">
<H4>A. Finding station information in <em>debugfs</em></H4>

<p>When the 802.11 interface connects to another station, a directory is created in <em>debugfs</em> with the station's MAC address. Note that if the interface is in client mode, it will only connect to one station&mdash;the AP&mdash;while in other modes it may connect to multiple stations. To list these stations:</p>

<pre>
$ sudo ls /sys/kernel/debug/ieee80211/phy0/netdev:wlan0/stations/
00:0f:34:9d:01:a0
</pre>

<p>(The names <em>phy0</em> and <em>wlan0</em> used here may be different on your system, particularly if you have more than one wireless adapter.) The directory for each station will contain several entries with different information about the station. One of these entries is <tt>rate_scale_table</tt>, shown here:</p>

<pre>
$ sudo cat /sys/kernel/debug/ieee80211/phy0/netdev:wlan0/stations/00:0f:34:9d:01:a0/rate_scale_table
sta_id 0
failed=0 success=0 rate=0FFF
fixed rate 0x0
valid_tx_ant ANT_A,ANT_B,ANT_C
lq type legacy
last tx rate=0x420A
general:flags=0x0 mimo-d=0 s-ant0x1 d-ant=0x3
agg:time_limit=4000 dist_start_th=3 frame_cnt_limit=31
Start idx [0]=0x0 [1]=0x0 [2]=0x0 [3]=0x0
 rate[0] 0x420A 1mbps
 rate[1] 0x420A 1mbps
 rate[2] 0x420A 1mbps
 rate[3] 0x420A 1mbps
 rate[4] 0x420A 1mbps
 rate[5] 0x420A 1mbps
 rate[6] 0x420A 1mbps
 rate[7] 0x420A 1mbps
 rate[8] 0x420A 1mbps
 rate[9] 0x420A 1mbps
 rate[10] 0x420A 1mbps
 rate[11] 0x420A 1mbps
 rate[12] 0x420A 1mbps
 rate[13] 0x420A 1mbps
 rate[14] 0x420A 1mbps
 rate[15] 0x420A 1mbps
</pre>

<p>This output indicates that for the station with the MAC address <em>00:0f:34:9d:01:a0</em>,</p>
<ul>
<li>all three transmit antennas can be used with this station (<tt>valid_tx_ant ANT_A,ANT_B,ANT_C</tt>),</li>
<li>this is <em>not</em> a High Throughput (802.11n) station (<tt>lq type legacy</tt>&mdash;instead of <tt>lq type HT</tt>),</li>
<li>the last frame transmitted to this station was transmitted with rate <tt>0x420A</tt>, and</li>
<li>the 16 possible transmit rates that may be used for this station are all the same (<tt>0x420A</tt>).</li>
</ul>

<H4>B. Understanding how rates are represented</H4>

<p>The rates shown above are 32-bit values in the <tt>rate_n_flags</tt> format <a href="https://github.com/dhalperi/linux-80211n-csitool/blob/csitool-3.13/drivers/net/wireless/iwlwifi/dvm/commands.h#L245-L334">described in the source code</a>. Breaking down the value <tt>0x420A</tt>, for example, reveals that:</p>

<pre>
0x420A =
           0x4000        (RATE_MCS_ANT_A_MSK)
         | 0x0200        (RATE_MCS_CCK_MSK)
         | 0x000A        (10 = 1 Mbps)
</pre>

<ul>
<li>frames are sent on Antenna A,</li>
<li>frames are sent with the CCK modulation scheme (802.11b), and</li>
<li>frames are sent at 1 Mbps.</li>
</ul>

<p>As a different example, the value for a High Throughput station might be <tt>0x1c113</tt>, where:</p>

<pre>
0x1c113 =
            0x1c000      (RATE_MCS_ANT_ABC_MSK)
          | 0x00000      (! RATE_MCS_SGI_MSK)
          | 0x00000      (! RATE_MCS_HT40_MSK)
          | 0x00100      (RATE_MCS_HT_MSK)
          | 0x00013      (19)
</pre>

<ul>
<li>frames are sent on Antennas A, B, and C,</li>
<li>frames are <em>not</em> sent with a short guard interval,</li>
<li>frames are <em>not</em> sent with a 40 MHz channel width,</li>
<li>frames are sent with a High Throughput modulation and coding scheme (802.11n), and</li>
<li>frames are sent using MCS 19 (3 streams with 16QAM-1/2).</li>
</ul>

<p>These parameters correspond to a data rate of 78 Mbps; refer to Tables 20-29 through 20-43 in the IEEE 802.11n standard (summarized <a href="http://en.wikipedia.org/wiki/IEEE_802.11n-2009#Data_rates">here</a>). Note: the adapter only supports MCS 0&ndash;23.</p>

<H4>C. Setting the transmit rate to another station</H4>

<p>The driver allows you to override its rate selection algorithm for a station, setting all of the 16 possible transmit rates to the same value, by writing the value to <tt>rate_scale_table</tt> for the station:<p>

<pre>
$ echo 0x4214 | sudo tee \
>     /sys/kernel/debug/ieee80211/phy0/netdev:wlan0/stations/00:0f:34:9d:01:a0/rate_scale_table
</pre>

<p>This example sets the transmit rate for the station above to 2 Mbps, using Antenna A. (Use care: setting an invalid rate may cause the firmware to crash or the driver to stop functioning.)</p>

<H4>D. Setting the transmit rate for broadcast frames</H4>

<p>Another entry in <em>debugfs</em> allows setting the transmit rate for broadcast frames. Note that this does not have any effect in client mode, since broadcast frames are transmitted to the AP first.<p>

<pre>
$ echo 0x1c113 | sudo tee /sys/kernel/debug/ieee80211/phy0/iwlwifi/iwldvm/debug/bcast_tx_rate
</pre>

<p>(For kernel versions prior to 3.6, remove the <tt>iwldvm/</tt> component from the path.)</p>

<H4>E. Setting the transmit rate for injection in monitor mode</H4>

<p>A separate entry in <em>debugfs</em> can be written to select the transmit rate that will be used when injecting frames in monitor mode:<p>

<pre>
$ echo 0x1c113 | sudo tee /sys/kernel/debug/ieee80211/phy0/iwlwifi/iwldvm/debug/monitor_tx_rate
</pre>

<p>(For kernel versions prior to 3.6, remove the <tt>iwldvm/</tt> component from the path.)</p>

</div>

<!--- ********************************************************************* -->
<H3>2. How do I process CSI with MATLAB or Octave? [<a href="javascript:void(0);" onclick="toggle(this, 'inspectcsi');">+</a>] </H3>

<div id="inspectcsi" style="display:none;">
<H4>A. Parsing the CSI trace file</H4>

<p>Using MATLAB/Octave, change to the <em>matlab</em> directory in the CSI Tool supplementary material:</p>

<pre>
cd linux-80211n-csitool-supplementary/matlab
</pre>

<p>Now read in the CSI trace file. A sample file is included in the supplementary material, but you can also use the file that is generated by following the last step of the <a href="installation.html">installation instructions</a>.</p>

<pre>
csi_trace = read_bf_file('sample_data/log.all_csi.6.7.6');
</pre>

<p><strong>Note that this uses a MEX-file</strong> compiled from <tt>read_bfee.c</tt> to unpack the binary CSI format. If this does not work, recompile this MEX-file using MATLAB/Octave and try again.</p>

<H4>B. Inspecting the CSI</H4>

<p>In our sample file, <tt>csi_trace</tt> is a 1x29 cell array, which holds 29 structs. This contains the CSI information for 29 received packets. Let's inspect one of the entries:</p>

<pre>
&gt;&gt; csi_entry = csi_trace{1}	<b>(Note the curly-braces {}, not parentheses ().)</b>

csi_entry =

    timestamp_low: 4            <b>(In the sample trace, timestamp_low is invalid and always 4.)</b>
       bfee_count: 72
              Nrx: 3
              Ntx: 1
           rssi_a: 33
           rssi_b: 37
           rssi_c: 41
            noise: -127
              agc: 38
             perm: [3 2 1]
             rate: 256
              csi: [1x3x30 double]
</pre>

<p>Let's break down this display:</p>

<ul>
	<li><b><tt>timestamp_low</tt></b> is the low 32 bits of the NIC's 1 MHz clock. It wraps about every 4300 seconds, or 72 minutes. This field was not yet recorded in the sample trace, so all values are arbitrary and always equal <code>4</code>.</li>
	<li><b><tt>bfee_count</tt></b> is simply a count of the total number of beamforming measurements that have been recorded by the driver and sent to userspace. The <tt>netlink</tt> channel between the kernel and userspace is lossy, so these can be used to detect measurements that were dropped in this pipe.</li>
	<li><b><tt>Nrx</tt></b> represents the number of antennas used to receive the packet by this NIC, and <b><tt>Ntx</tt></b> represents the number of space/time streams transmitted. In this case, the sender sent a single-stream packet and the receiver used all 3 antennas to receive it.</li>
	<li><b><tt>rssi_a</tt></b>, <b><tt>rssi_b</tt></b>, and <b><tt>rssi_c</tt></b> correspond to RSSI measured by the receiving NIC at the input to each antenna port. This measurement is made during the packet preamble. This value is in <tt>dB</tt> relative to an internal reference; to get the received signal strength in <tt>dBm</tt> we must combine it with the Automatic Gain Control (AGC) setting (<b><tt>agc</tt></b>) in <tt>dB</tt> and also subtract off a magic constant. This process is explained below.</li>
	<li><b><tt>perm</tt></b> tells us how the NIC permuted the signals from the 3 receive antennas into the 3 RF chains that process the measurements. The sample value of <b><tt>[3 2 1]</tt></b> implies that Antenna C was sent to RF Chain A, Antenna B to Chain B, and Antenna A to Chain C. This operation is performed by an antenna selection module in the NIC and generally corresponds to ordering the antennas in decreasing order of RSSI.</li>
	<li><b><tt>rate</tt></b> is the rate at which the packet was sent, in the same format as the <tt>rate_n_flags</tt> defined <a href="#faqrate">above</a>. Note that the antenna bits are omitted, as there is no way for the receiver to know which transmit antennas were used.</li>
	<li><b><tt>csi</tt></b> is the CSI itself, normalized to an internal reference. It is a <tt><b>Ntx</b>&times;<b>Nrx</b>&times;30</tt> 3-D matrix where the third dimension is across 30 subcarriers in the OFDM channel. For a 20 MHz-wide channel, these correspond to about half the OFDM subcarriers, and for a 40 MHz-wide channel, this is about one in every 4 subcarriers. Which subcarriers were measured is defined by the <a href="http://standards.ieee.org/getieee802/download/802.11n-2009.pdf">802.11n standard (in Table 7-25f on page 50)</a>.</li>
</ul>

<p>Now that we've described all the fields of this struct, we need to put them all together to compute the CSI in absolute units, rather than Intel's internal reference level. In particular, we need to combine the RSSI and AGC values together to get RSS in <tt>dBm</tt>, and include noise to get SNR. If there is no noise, as in the sample case, we instead use a hard-coded noise floor of <tt>-92</tt> <tt>dBm</tt>. We use the script <tt>get_scaled_csi.m</tt> to do this:<p>

<pre>
&gt;&gt; csi = get_scaled_csi(csi_entry);
</pre>

<p>Finally, <tt><b>csi</b></tt> is a <tt>1&times;3&times;30</tt> matrix that represents the MIMO channel state for this link. It's units are in linear&mdash;i.e., not <tt>dB</tt>&mdash;voltage space. This is the format used in all textbooks I've seen, that is, we've normalized the CSI (in textbooks, usually called <i>H</i>) such that there is unit noise.</p>

<H4>C. Plotting SNR</H4>

<p>Let's look at the three different spatial paths on the <tt>1&times;3</tt> link we measured:</p>

<pre>
&gt;&gt; plot(db(abs(squeeze(csi).')))
&gt;&gt; legend('RX Antenna A', 'RX Antenna B', 'RX Antenna C', 'Location', 'SouthEast' );
&gt;&gt; xlabel('Subcarrier index');
&gt;&gt; ylabel('SNR [dB]');
</pre>

<p>In the plot command, <tt>squeeze()</tt> turns <b><tt>csi</tt></b> into a <tt>3&times;30</tt> matrix by removing the first singleton dimension. <tt>db()</tt> converts from linear (voltage) space into logarithmic (base-10, power) space. <tt>abs</tt> converts each complex number into its magnitude. Finally, the <tt><b>.'</tt></b> operator transposes the squeezed CSI from <tt>3&times;30</tt> matrix into a <tt>30&times;3</tt> matrix, and does not complement the complex numbers. Combined, we get the plot below.</p>

<center>
	<a href="img/sample_csi_plot.png"><img src="img/sample_csi_plot.png" width="400" title="a sample CSI plot"></a>
</center>

<p>We see that this is a mostly flat link, with relatively little frequency-selective fading (around <tt>3</tt> <tt>dB</tt> for most antenna pairs). However, there is a fair (perhaps <tt>8</tt> <tt>dB</tt>) difference between the best antenna C and the worst antenna A. This matches the difference between <b><tt>rssi_a</tt></b> and <b><tt>rssi_c</tt></b> (as we expect it should).</p>

<H4>D. Computing effective SNR values</H4>

<p>We'll conclude our discussion of the CSI by showing you how to compute the Effective SNR from our CSI matrices. To do so, we use the <tt>get_eff_SNRs</tt> script, which takes as input a CSI matrix and returns a <tt>7&times;4</tt> matrix of effective SNR values in linear (power) space. The 4 columns correspond to the effective SNR using the four 802.11 modulation schemes, namely BPSK/QPSK/16QAM/64QAM. The 7 rows correspond to the seven possible antenna selections with 3 antennas and 1, 2, or 3 spatial streams. In particular, the first 3 rows correspond to single-stream transmissions with antenna A, B, or C. The next 3 rows correspond to dual-stream transmissions with antennas AB, AC, or BC. The last row corresponds to a 3-stream transmission using all antennas.</p>

<pre>
&gt;&gt; db(get_eff_SNRs(csi), 'pow')

ans =

   22.1821   22.2698   22.9007   24.6297
 -156.5356 -156.5356 -156.5356 -156.5356
 -156.5356 -156.5356 -156.5356 -156.5356
 -156.5356 -156.5356 -156.5356 -156.5356
 -156.5356 -156.5356 -156.5356 -156.5356
 -156.5356 -156.5356 -156.5356 -156.5356
 -156.5356 -156.5356 -156.5356 -156.5356
</pre>

<p>Okay, that's pretty disappointing! What happened? Well, note that this is a <tt>1&times;3</tt> link, so the only valid antenna configuration is SIMO with the single transmit antenna we measured. The other 6 rows correspond to a very small SNR, i.e, a large, negative <tt>dB</tt>.</p>

<p>Let's look at a <tt>3&times;3</tt> matrix instead:</p>

<pre>
&gt;&gt; csi_entry = csi_trace{20}

csi_entry =

    timestamp_low: 4
       bfee_count: 91
              Nrx: 3
              Ntx: 3
           rssi_a: 34
           rssi_b: 39
           rssi_c: 39
            noise: -127
              agc: 40
             perm: [2 3 1]
             rate: 272
              csi: [3x3x30 double]

&gt;&gt; csi = get_scaled_csi(csi_entry);
&gt;&gt; db(get_eff_SNRs(csi), 'pow')

ans =

       Inf       Inf   32.3435   32.6069
       Inf       Inf   32.4238   32.6822
       Inf       Inf   32.2353   32.5051
   25.4763   25.5262   25.8974   26.8482
   24.6893   24.7490   25.1933   26.5660
   21.9185   22.0303   22.8060   24.6483
    6.5818    8.2321   12.4185   16.2016
</pre>

<p>Here, all 7 rows are valid because there are three transmit antennas. We see that all the SIMO streams are very likely to work; in fact, for BPSK and QPSK there are so few errors that MATLAB's error functions can't distinguish it from zero, and the SNR is effectively infinite. The MIMO2 rates are also likely to work, but only some of the MIMO3 rates will work. See our <a href="http://homes.cs.washington.edu/~dhalperi/pubs/comm356s-halperin.pdf">SIGCOMM 2010 paper</a> for more details.</p>
</div>

<!--- ********************************************************************* -->
<H3 id="troublenm">3. Why does "deauthenticating [...] by local choice (reason=3)" appear with <tt>dmesg</tt>? [<a href="javascript:void(0);" onclick="toggle(this, 'troublenmfold');">+</a>] </H3>

<div id="troublenmfold" style="display:none;">

<p>If <tt>NetworkManager</tt> is installed, did you disable its control of the wireless interface? This is needed if you are using command line utilities such as <tt>iw</tt> to configure the interface. Using Ubuntu:</p>
<pre>
echo iface wlan0 inet manual | sudo tee -a /etc/network/interfaces
sudo restart network-manager
</pre>
</div>

<!--- ********************************************************************* -->
<H3 id="others">4. Does the CSI Tool work with a different Intel device (e.g., IWL 6300)? [<a href="javascript:void(0);" onclick="toggle(this, 'othersfold');">+</a>] </H3>

<div id="othersfold" style="display:none;">

<p>No. The tool relies on my custom firmware image which only works on the IWL 5300.</p>
</div>

<!--- ********************************************************************* -->
<H3 id="csirx">5. For which packets is CSI measured? [<a href="javascript:void(0);" onclick="toggle(this, 'csirxfold');">+</a>] </H3>

<div id="csirxfold" style="display:none;">

<p>CSI is measured from a received packet under the following conditions:</p>
<ul>
	<li><p>The packet is transmitted using an 802.11n "HT" rate.</p></li>
  <li><p>The receiver's logical configuration (e.g., channel type is HT, and channel width) and its physical configuration (e.g., correct number of antennas connected, all antennas work in the configured band, all antennas are enabled in the firmware) support the transmitted rate.</p></li>
  <li><p>The receiver decodes the packet correctly, with no errors.</p><p>AND depending on the mode:</p></li>
	<li><p><em>Client mode:</em> The packet is transmitted by the connected AP, and the destination is either the local address or broadcast.</p></li>
	<li><p><em>AP mode:</em> The packet is transmitted by a connected client.</p></li>
	<li><p><em>IBSS (ad-hoc) mode:</em> The packet is transmitted by another station in the connected IBSS, and the destination is either the local address or broadcast.</p></li>
	<li><p><em>Monitor mode:</em> The packet is addressed both to and from a hardcoded, fixed address 00:16:ea:12:34:56. See the <a href="https://github.com/dhalperi/linux-80211n-csitool-supplementary/tree/master/injection">injection scripts</a>, using <code>mode 1</code> only.</p></li>
</ul>
<p>In other words, CSI is <strong>not</strong> recorded for overheard 802.11n conversations. It is also not recorded for beacons from a connected AP if they are sent a non-HT rate (e.g., the 802.11a/g 6 Mbps rate). I also note that there is only one CSI measurement per 802.11n A-MPDU (aggregation batch) since there is really only "one" preamble.</p>
</div>

<!--- ********************************************************************* -->
<H3 id="subcarriers">6. Which subcarriers are measured? [<a href="javascript:void(0);" onclick="toggle(this, 'subcarriersfold');">+</a>] </H3>

<div id="subcarriersfold" style="display:none;">

	<p>The set of subcarriers measured is specified by the IEEE 802.11n-2009 standard; see Table 7-25f. Intel's implementation only supports the versions that measure 30 subcarriers each, corresponding to <em>Ng</em> = 2 for 20 MHz and <em>Ng</em> = 4 for 40 MHz.</p>
</div>


<!--- ********************************************************************* -->
<H3 id="encryption">7. Why doesn't the CSI tool work for encrypted access points? [<a href="javascript:void(0);" onclick="toggle(this, 'encryptionfold');">+</a>] </H3>

<div id="encryptionfold" style="display:none;">

	<p>The firmware for this device did not have enough code room for both the beamforming software paths (required to measure CSI) and the encryption software paths (required for WEP/WPA/WPA2/etc. networks).</p>
	<p>There may be a workaround if you can get the kernel software stack to use the kernel's software implementation of crypto, but I've never had the time to try it. Please let me know if you get it to work!</p>
</div>

<!--- ********************************************************************* -->
<H3 id="licensing">8. How is the CSI tool code licensed? [<a href="javascript:void(0);" onclick="toggle(this, 'licensingfold');">+</a>] </H3>

<div id="licensingfold" style="display:none;">

	<p>Our changes to kernel code don't affect the existing licenses in the kernel: GPLv2.</p>
	<p>The firmware is under the same license as Intel's firmware. You can find it <a href="http://git.kernel.org/cgit/linux/kernel/git/firmware/linux-firmware.git/plain/LICENCE.iwlwifi_firmware?id=HEAD">here</a>.</p>
	<p>Any code that we wrote is under the <a href="http://opensource.org/licenses/MIT">MIT license</a>.</p>
</div>

<!--- ********************************************************************* -->
<H3 id="program">9. The CSI Tool does not support a feature I want. Can I reprogram/modify the firmware source code? [<a href="javascript:void(0);" onclick="toggle(this, 'programfold');">+</a>] </H3>

<div id="programfold" style="display:none;">

	<p>No.</p>
	<p>We produced the modified firmware while employed at Intel with access to proprietary code, documents, and tools. We no longer have access to these tools and, unless you work at Intel, neither do you. Sorry!</p>
	<p>A very strong thank you to Intel for very graciously allowing us to use and distribute the binary version of the modified firmware!</p>
</div>

<!--- ********************************************************************* -->
<H3 id="apmode">10. How do I deal with firmware crashes in AP mode? [<a href="javascript:void(0);" onclick="toggle(this, 'apmodefold');">+</a>] </H3>

<div id="apmodefold" style="display:none;">

	<p>The access point implementation on this chipset is fairly incomplete; the feature was started and abandoned internally, and the engineers never subjected it to rigorous tests. We enabled it for the CSI Tool as a hack. In our experiments, AP mode seemed to work well enough for links that also used an Intel 5300 client in a quiet network, but other Wi-Fi devices sometimes cause unavoidable crashes.</p>
	<p>In our own work, we found the CSI Tool to be most effective when using the injection scripts with devices in monitor mode. Client mode, AP mode, and ad-hoc modes never worked well, if at all, for us.</p>
</div>

<!--- ********************************************************************* -->
<H3 id="injection">11. How can I get CSI measurements on multiple links at once? [<a href="javascript:void(0);" onclick="toggle(this, 'injectionfold');">+</a>] </H3>

<div id="injectionfold" style="display:none;">

	<p>First, please read #5 &ndash; "For which packets is CSI measured?". Hopefully, this description will make it clear why you are unlikely to ever get many good measurements in traditional AP/client networks.</p>
	<p>We recommend that you use injection mode for most multi-link measurements. Please see the instructions <a href="https://github.com/dhalperi/linux-80211n-csitool-supplementary/tree/master/injection">here</a>.</p>
</div>

<!--- ********************************************************************* -->
<H3 id="logging">12. Can I log other information like payloads or sequence numbers for received packets? [<a href="javascript:void(0);" onclick="toggle(this, 'loggingfold');">+</a>] </H3>

<div id="loggingfold" style="display:none;">
  <p>First, please read #5 &ndash; "For which packets is CSI measured?". This answer provides useful background for understanding the relationship and interleaving between CSI measurements and other logs.</p>
  <p>You can find the information that may be logged by looking at the <a href="https://github.com/dhalperi/linux-80211n-csitool/blob/f3dba8bb3aac341fa1ffcae7c5d6815182493a5d/drivers/net/wireless/iwlwifi/iwl-connector.h#L62"><code>iwl-connector.h</code> header file</a> in the driver folder. Each of these flags may be set to relay one or more types of messages from the kernel to userspace programs like <code>log_to_file</code>.</p>
  <p>The default setting is <code>IWL_CONN_BFEE_NOTIF_MSK</code> -- the beamforming information feedback is logged. Other options:</p>
  <ul>
    <li>Enabling <code>IWL_CONN_RX_PHY_MSK</code> will log additional physical information. However, we already copy the most relevant information from this structure into the beamforming response (<a href="https://github.com/dhalperi/linux-80211n-csitool/blob/f3dba8bb3aac341fa1ffcae7c5d6815182493a5d/drivers/net/wireless/iwlwifi/iwl-agn-lib.c#L59">see code here</a>).</li>
    <li>Enabling <code>IWL_CONN_RX_MPDU_MSK</code> will log packet payloads. This message should include, e.g., the IEEE 802.11 sequence number and of course packet payload which you could use for application or measurement-specific purposes.</li>
    <li>... other masks log other information, which it will benefit you the user to discover by reading the kernel. :)</li>
  </ul>
  <p><strong>To set which information is logged</strong>, please set the mask to the union of all information you require to be logged. For example, to log both CSI measurements and packet payloads, the mask would be <code>IWL_CONN_BFEE_NOTIF_MSK | IWL_CONN_RX_MPDU_MSK</code>, or <code>0x5</code>. Once you know the desired mask, you would set it by (re-)loading the <code>iwlwifi</code> module with the <code>connector_log</code> flag set:</p>
<pre>
modprobe iwlwifi connector_log=0x5
</pre>
<p>The default value for <code>connector_log</code> is <code>0</code>, and the recommended value in the <a href="installation.html">installation instructions</a> is <code>0x1</code>, which only logs beamforming information.</p>
</div>

<!--- ********************************************************************* -->
<H3 id="5ghz">13. Why am I unable to operate in AP or IBSS (ad-hoc) modes on 5 GHz channels? [<a href="javascript:void(0);" onclick="toggle(this, '5ghzfold');">+</a>] </H3>

<div id="5ghzfold" style="display:none;">

<p>These modes require beaconing, which cannot be performed by this adapter on channels where radar detection is required (since it is not implemented). The regulations for specific channels, including whether radar detection is required, vary by country.</p>

<p>First, make sure that the regulatory domain is set in the kernel, so that it is <a href="https://wireless.wiki.kernel.org/en/developers/Regulatory/processing_rules#hidden_ssids">not world roaming</a>.</p>

<p>The adapter's EEPROM also contains regulatory settings for each channel, which might be more or less restrictive than the actual regulations where you are operating. The firmware reads and uses the regulatory settings directly from the EEPROM. The driver reads the settings from the EEPROM and combines them with the regulatory data used by the kernel; to examine the result:</p>
<pre>
$ iw phy
Wiphy phy0
	Band 1:
[ ... ]
		Frequencies:
			* 2412 MHz [1] (24.0 dBm)
			* 2417 MHz [2] (24.0 dBm)
			* 2422 MHz [3] (24.0 dBm)
			* 2427 MHz [4] (24.0 dBm)
			* 2432 MHz [5] (24.0 dBm)
			* 2437 MHz [6] (24.0 dBm)
			* 2442 MHz [7] (24.0 dBm)
			* 2447 MHz [8] (24.0 dBm)
			* 2452 MHz [9] (24.0 dBm)
			* 2457 MHz [10] (24.0 dBm)
			* 2462 MHz [11] (24.0 dBm)
[ ... ]
	Band 2:
[ ... ]
		Frequencies:
			* 5180 MHz [36] (14.0 dBm)
			* 5200 MHz [40] (14.0 dBm)
			* 5220 MHz [44] (14.0 dBm)
			* 5240 MHz [48] (14.0 dBm)
			* 5260 MHz [52] (17.0 dBm) (radar detection)
			* 5280 MHz [56] (17.0 dBm) (radar detection)
			* 5300 MHz [60] (17.0 dBm) (radar detection)
			* 5320 MHz [64] (17.0 dBm) (radar detection)
			* 5500 MHz [100] (17.0 dBm) (radar detection)
			* 5520 MHz [104] (17.0 dBm) (radar detection)
			* 5540 MHz [108] (17.0 dBm) (radar detection)
			* 5560 MHz [112] (17.0 dBm) (radar detection)
			* 5580 MHz [116] (17.0 dBm) (radar detection)
			* 5660 MHz [132] (17.0 dBm) (radar detection)
			* 5680 MHz [136] (17.0 dBm) (radar detection)
			* 5700 MHz [140] (17.0 dBm) (radar detection)
			* 5745 MHz [149] (27.0 dBm)
			* 5765 MHz [153] (27.0 dBm)
			* 5785 MHz [157] (27.0 dBm)
			* 5805 MHz [161] (27.0 dBm)
			* 5825 MHz [165] (27.0 dBm)
[ ... ]
</pre>

<p>This output shows that in the 5 GHz band, beaconing is allowed for channels within the 5170&ndash;5250 MHz and 5735&ndash;5835 MHz ranges.</p>
</div>

<!--- ********************************************************************* -->
<H3 id="modulesig">14. Why does "module verification failed: signature and/or required key missing" appear? [<a href="javascript:void(0);" onclick="toggle(this, 'modulesigfold');">+</a>] </H3>

<div id="modulesigfold" style="display:none;">

<p>This will occur if the module was not signed during installation, and if the kernel is configured to enforce module signature verification. To work around this, you will need to disable <a href="https://wiki.ubuntu.com/SecurityTeam/SecureBoot">Secure Boot</a> and/or add a <a href="https://wiki.ubuntu.com/Kernel/KernelBootParameters">kernel boot parameter</a>: <tt>enforcemodulesig=0</tt></p>
</div>

<!--- ********************************************************************* -->
<center>
	<H4><a href="index.html">Back to the main page</a></H4>
</center>

<!--- ********************************************************************* -->
    <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ?
        "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost +
        "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
        var pageTracker = _gat._getTracker("UA-3907502-1");
        pageTracker._initData();
        pageTracker._trackPageview();
    </script>
</body>
</html>
